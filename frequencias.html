<!DOCTYPE HTML>
<html>
<head>


	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript">


window.onload = function () {

var chart = new CanvasJS.Chart("chartContainer", {
	title: {
		text: "Frequencias"
	},
	axisY: {
		title: "Mag",
		includeZero: true,
		suffix: " °C"
	},
	data: [{
		type: "column",	
		yValueFormatString: "#,### °C",
		indexLabel: "{y}",
		dataPoints: [
			{ label: "1 KHz", y: 206 },
			{ label: "2.5 KHz", y: 163 },
			{ label: "6.25 KHz", y: 154 },
			{ label: "11 KHz", y: 176 },

		]
	}]
});

function successCallBack(freq,yVal){
	var boilerColor, deltaY;
	var dps = chart.options.data[0].dataPoints;
	deltaY = Math.round(2 + Math.random() *(-2-2));
	boilerColor = yVal > 200 ? "#FF2500" : yVal >= 170 ? "#FF6000" : yVal < 170 ? "#6B8E23 " : null;
	dps[freq-1] = {label: "Freq "+(freq+1) , y: yVal, color: boilerColor};	
	chart.options.data[0].dataPoints = dps; 
	chart.render();
}

function getFreq(freq){
	$.ajax({
  			method: "POST",
  			url: "freqs.php",
			data: { freq: freq },
			success: function (data) {
				successCallBack(freq,parseFloat(data));
			},
			error: function() {
				successCallBack(freq,0);
        	}
   
		});
}

function updateChart() {
	var boilerColor, deltaY, yVal;
	var dps = chart.options.data[0].dataPoints;
	for (var i = 0; i < dps.length; i++) {
		yVal = getFreq(i+1);
	}
	
};
updateChart();

setInterval(function() {updateChart()}, 500);

}
</script>
</head>
<body>
<div id="chartContainer" style="height: 300px;"></div>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</body>
</html>